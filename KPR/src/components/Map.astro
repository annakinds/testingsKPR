---
import "leaflet/dist/leaflet.css";
---

<div id="map" style="height:100vh;"></div>

<script>
    import L from "leaflet";

    const map = L.map("map").setView([50.8285, 3.264], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "Â© OpenStreetMap",
    }).addTo(map);

    let selectedMarker = 0;

    fetch("/testingsKPR//data/KPR+Kortrijk.geojson")
        .then((r) => r.json())
        .then((data) => {
            L.geoJSON(data, {
                pointToLayer: (feature, latlng) => {
                    const isFeatured = feature.properties.featured;
                    const customIcon = L.icon({
                        iconUrl: isFeatured
                            ? "/testingsKPR/marker__yellow.svg"
                            : "/testingsKPR/marker__gray.svg",
                        iconSize: isFeatured ? [32, 32] : [24, 24],
                        iconAnchor: isFeatured ? [16, 32] : [12, 24],
                        popupAnchor: isFeatured ? [0, -32] : [0, -24],
                    });
                    return L.marker(latlng, { icon: customIcon });
                },
                onEachFeature(feature, layer) {
                    let popup = `<b>${feature.properties.name}</b>`;
                    if (feature.properties.description) {
                        popup += `<br><i>${feature.properties.description}</i>`;
                    }
                    layer.bindPopup(popup);

                    layer.on("click", () => {
                        if (selectedMarker) {
                            const wasFeatured =
                                selectedMarker.feature.properties.featured;
                            selectedMarker.setIcon(
                                L.icon({
                                    iconUrl: wasFeatured
                                        ? "/testingsKPR/marker__yellow.svg"
                                        : "/testingsKPR/marker__gray.svg",
                                    iconSize: [32, 32],
                                    iconAnchor: [16, 32],
                                    popupAnchor: [0, -32],
                                }),
                            );
                        }
                        selectedMarker = layer;
                        layer.setIcon(
                            L.icon({
                                iconUrl: "/testingsKPR/marker__orange.svg",
                                iconSize: [32, 32],
                                iconAnchor: [16, 32],
                                popupAnchor: [0, -32],
                            }),
                        );
                    });
                },
            }).addTo(map);
        });
</script>
